.ui.raised.teal.segment
  .ui.dividing.header
    i.search.icon
    | Filter Analytics

  .ui.form
    .equal.width.fields
      .field
        = label_tag :season
        = select_tag :season,
          options_for_select(@team.seasons.map{ |season| [season.title, season.id] }),
          include_blank: true,
          class: 'fluid dropdown'
      .field
        = label_tag :competition
        = select_tag :competition,
          options_for_select(@team.recorded_competitions, params[:competition]),
          include_blank: true,
          class: 'fluid dropdown'

table.ui.basic.sortable.definition.selectable.compact.small.table[width="100%"]
  thead
    - ['Name', 'Position', 'GP', 'Rating', 'Goals', 'Assists', 'CS'].each do |header|
      th = header

javascript:
  var table;

  $(function(){
    $('#season, #competition').change(function(){ table.ajax.reload() });

    table = $('table').DataTable({
      order: [[3, 'desc']],
      ajax: {
        url: '/my_fifa/analytics/players',
        data: function(d){
          d.season = $('select#season').val();
          d.competition = $('select#competition').val();
        },
        dataSrc: function(json){
          $.each(json.data, function(i, data){
            json.data[i].rank = data.gp * data.rating + 3 * data.goals + data.assists + data.cs;
          });
          return json.data;
        }
      },
      processing: true,
      columns: [
        { data: 'name' },
        { data: 'pos' },
        { data: 'gp' },
        { data: { _: 'rating', sort: 'rank' }, render: $.fn.dataTable.render.number(',', '.', '2') },
        { data: 'goals' },
        { data: 'assists' },
        { data: 'cs' },
      ],
      createdRow: function(nRow, aData){
        $.each(['Position', 'GP', 'Rating', 'Goals', 'Assists', 'CS'], function(i, label){
          $('td:nth-child('+(i+2)+')', $(nRow)).prepend(labeledData(label, ''));
        });
        if (!aData.active){
          $('td:first-child', $(nRow)).prepend('<i class="red attention icon"></i>');
          $(nRow).addClass('disabled')
        }
      }
    });
  });

  function labeledData(label, data){
    return "<div class=\"ui responsive basic right pointing label\">"+label+"</div>"+data;
  }