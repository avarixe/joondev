= form_for(@formation, as: :formation, remote: true, html: { class: 'ui fluid form' }) do |f|
  .ui.grid
    .equal.width.row
      .required.field.column[no-empty]
        = f.label :layout, 'Layout'
        = f.select :layout,                                                  \
          options_for_select(MyFifa::Formation::LAYOUTS, @formation.layout), \
          { include_blank: false },                                          \
          { class: 'fluid dropdown' }
      .column

  .ui.raised.green.segment
    #positions-container[style="display:none!important"]
      - (2..11).each do |no|
        .four.wide.column.field.pos[data-no=no no-empty]
          = f.text_field "pos_#{no}",
            value: (f.object.public_send("pos_#{no}"))

    .ui.mobile.reversed.stackable.grid
      / GK row
      .three.columns.centered.row
        .four.wide.column.field.pos[data-no=1 no-empty]
          = f.text_field :pos_1, value: 'GK'

  = f.submit 'Save Formation', class: 'ui primary button'
  = link_to 'Back', my_fifa_formations_path, class: 'ui basic button'

- content_for :modal_container do
  .ui.basic.tiny.success.modal
    .ui.icon.header
      i.green.checkmark.icon 
      | Formation has been successfully saved.

javascript:
  $(function(){
    organizePositions();
    $('#formation_layout').change(function(){
      organizePositions();
    })
  })
  
  function organizePositions(){
    var layout = $('#formation_layout').val().split("-").map(function(n){
      return parseInt(n);
    });
  
    var rows = [[]];
    var nRow = 0;     // current row index
    var posInRow = 0; // counter of pos in currow row
    
    for (var pos=2; pos <= 11; pos++){
      // If reached threshold of row, create next row
      if (rows[nRow].length == layout[nRow]){
        nRow++;
        rows.push([]);
      }
      rows[nRow].push(pos);
    }
  
    // Clear the grid of the previous layout
    $('.field.pos[data-no != 1]').appendTo('#positions-container');
    $('.grid > .row:not(:last-child)').remove();
  
    // Repopular the grid with row data
    for (var i=0; i < rows.length; i++){
      var rowClass = (rows[i].length % 2 == 0 ? 'four' : 'five') + " columns centered row";
  
      // Collect rows in container
      var rowElem = $('<div class="'+rowClass+'"></div>');
      for (var j=0; j < rows[i].length; j++)
        $('#positions-container .field[data-no='+rows[i][j]+']').appendTo(rowElem);
  
      // Add row to stackable grid
      $('.ui.stackable.grid').prepend(rowElem);
    }
    
    $('.ui.stackable.grid').transition({
      animation: 'pulse',
      queue: false,
    });
  }