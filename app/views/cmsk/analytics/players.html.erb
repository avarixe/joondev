<style>
  .table-container { overflow-x: scroll; }
  .table { min-width: 550px; }
  tr.inactive { background-color: #f4d5d5 !important; }
</style>

<div class="col-md-4">
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title text-center">
        <%= fa_icon 'search', text: 'Search Analytics' %>
      </div>
    </div>
    <div class="panel-body">
      <div class="form-group row">
        <%= label_tag :season, 'Season: ', class: 'col-xs-4 control-label' %>
        <div class="col-xs-8">
          <%= select_tag :season, 
            options_for_select(@team.recorded_seasons, params[:season]),
            include_blank: true,
            class: 'form-control' %>
        </div>
      </div>
      <div class="form-group row">
        <%= label_tag :competition, 'Competition: ', class: 'col-xs-4 control-label' %>
        <div class="col-xs-8">
          <%= select_tag :competition,
            options_for_select(@team.recorded_competitions, params[:competition]),
            include_blank: true,
            class: 'form-control' %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="table-container col-md-8">
  <table class="table table-hover table-striped">
    <thead class="thead-inverse">
      <% ['Name', 'Position', 'GP', 'Rating', 'Goals', 'Assists', 'CS'].each do |header| %>
        <th><%= header %></th>
      <% end %>
    </thead>
  </table>
</div>

<script>
  var table;

  $(function(){
    table = $('table').DataTable({
      order: [[3, "desc"]],
      ajax: {
        url: '/cmsk/analytics/players',
        data: function(d){
          d.season = $('select#season').val();
          d.competition = $('select#competition').val();
        }
      },
      processing: true,
      columns: [
        { data: 'name' },
        { data: 'pos' },
        { data: 'gp' },
        { data: 'rating', render: $.fn.dataTable.render.number(',', '.', '2') },
        { data: 'goals' },
        { data: 'assists' },
        { data: 'cs' },
      ],
      rowCallback: function(nRow, aData){
        if (!aData.active) $(nRow).addClass('inactive')
      }
    });

    $('#competition').change(function(){
      table.ajax.reload(null, false);

      $.getJSON('/cmsk/analytics/get_seasons?competition='+$('#competition').val(), function(data){

      });
    });

    $('#season').change(function(){
      table.ajax.reload(null, false);

      $.getJSON('/cmsk/analytics/get_competitions?season='+$('#season').val(), function(data){

      });      
    });
  });
</script>